{% extends 'common/base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="h3 mb-2">Admin Dashboard</h1>
        <p class="text-muted">System overview and management</p>
    </div>
    <div class="col-auto">
        <div class="badge bg-success fs-6">
            <i class="fas fa-circle me-1"></i>System: {{ system_status }}
        </div>
    </div>
</div>

<!-- System Overview Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">{{ total_users }}</h2>
                        <p class="mb-0">Total Users</p>
                    </div>
                    <i class="fas fa-users fa-2x opacity-50"></i>
                </div>
                <div class="mt-2">
                    <small><i class="fas fa-arrow-up me-1"></i>{{ new_users_week }} new this week</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">{{ total_jobs }}</h2>
                        <p class="mb-0">Total Jobs</p>
                    </div>
                    <i class="fas fa-briefcase fa-2x opacity-50"></i>
                </div>
                <div class="mt-2">
                    <small><i class="fas fa-arrow-up me-1"></i>{{ new_jobs_week }} new this week</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">{{ total_applications }}</h2>
                        <p class="mb-0">Applications</p>
                    </div>
                    <i class="fas fa-file-alt fa-2x opacity-50"></i>
                </div>
                <div class="mt-2">
                    <small><i class="fas fa-arrow-up me-1"></i>{{ new_applications_week }} new this week</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">{{ total_companies }}</h2>
                        <p class="mb-0">Companies</p>
                    </div>
                    <i class="fas fa-building fa-2x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Left Column -->
    <div class="col-md-8">
        <!-- User Statistics -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">User Statistics</h5>
                <a href="/admin/auth/user/" class="btn btn-sm btn-outline-primary">Manage Users</a>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-4 mb-3">
                        <div class="border rounded p-3">
                            <h3 class="text-primary">{{ job_seekers }}</h3>
                            <p class="mb-0 text-muted">Job Seekers</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="border rounded p-3">
                            <h3 class="text-success">{{ employers }}</h3>
                            <p class="mb-0 text-muted">Employers</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="border rounded p-3">
                            <h3 class="text-info">{{ admins }}</h3>
                            <p class="mb-0 text-muted">Administrators</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="row">
            <!-- Recent Users -->
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">Recent Users</h6>
                    </div>
                    <div class="card-body">
                        {% if recent_users %}
                            {% for user in recent_users %}
                            <div class="d-flex align-items-center mb-3 pb-2 border-bottom">
                                <div class="flex-shrink-0">
                                    {% if user.profile_picture %}
                                        <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}" 
                                             class="rounded-circle" width="40" height="40">
                                    {% else %}
                                        <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" 
                                             style="width: 40px; height: 40px;">
                                            <i class="fas fa-user text-muted"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-0 small">{{ user.username }}</h6>
                                    <small class="text-muted">{{ user.get_user_type_display }}</small>
                                    <br>
                                    <small class="text-muted">{{ user.date_joined|timesince }} ago</small>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted text-center">No recent users</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Recent Jobs -->
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">Recent Jobs</h6>
                    </div>
                    <div class="card-body">
                        {% if recent_jobs %}
                            {% for job in recent_jobs %}
                            <div class="mb-3 pb-2 border-bottom">
                                <h6 class="mb-1 small">{{ job.title }}</h6>
                                <small class="text-muted">{{ job.company.name }}</small>
                                <br>
                                <small class="text-muted">
                                    {{ job.created_at|timesince }} ago â€¢ 
                                    <span class="badge {% if job.is_active %}bg-success{% else %}bg-secondary{% endif %}">
                                        {% if job.is_active %}Active{% else %}Inactive{% endif %}
                                    </span>
                                </small>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted text-center">No recent jobs</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Applications -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Recent Applications</h5>
            </div>
            <div class="card-body">
                {% if recent_applications %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Applicant</th>
                                    <th>Job</th>
                                    <th>Company</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for application in recent_applications %}
                                <tr>
                                    <td>
                                        <small>{{ application.applicant.username }}</small>
                                    </td>
                                    <td>
                                        <small>{{ application.job.title|truncatewords:3 }}</small>
                                    </td>
                                    <td>
                                        <small>{{ application.job.company.name }}</small>
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if application.status == 'submitted' %}bg-secondary
                                            {% elif application.status == 'under_review' %}bg-primary
                                            {% elif application.status == 'shortlisted' %}bg-warning
                                            {% elif application.status == 'accepted' %}bg-success
                                            {% else %}bg-danger{% endif %}">
                                            {{ application.get_status_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <small>{{ application.applied_date|timesince }} ago</small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted text-center">No recent applications</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Right Column -->
    <div class="col-md-4">
        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="/admin/" class="btn btn-primary">
                        <i class="fas fa-cog me-2"></i>Django Admin
                    </a>
                    <a href="/admin/jobs/job/" class="btn btn-outline-primary">
                        <i class="fas fa-briefcase me-2"></i>Manage Jobs
                    </a>
                    <a href="/admin/auth/user/" class="btn btn-outline-success">
                        <i class="fas fa-users me-2"></i>Manage Users
                    </a>
                    <a href="/admin/jobs/company/" class="btn btn-outline-info">
                        <i class="fas fa-building me-2"></i>Manage Companies
                    </a>
                    <a href="/admin/jobs/application/" class="btn btn-outline-warning">
                        <i class="fas fa-file-alt me-2"></i>Manage Applications
                    </a>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">System Information</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <strong>System Status:</strong>
                    <span class="badge bg-success float-end">{{ system_status }}</span>
                </div>
                <div class="mb-3">
                    <strong>Database Size:</strong>
                    <span class="float-end">{{ database_size }}</span>
                </div>
                <div class="mb-3">
                    <strong>Uptime:</strong>
                    <span class="float-end">{{ uptime }}</span>
                </div>
                <div class="mb-3">
                    <strong>Server Time:</strong>
                    <span class="float-end">{{ today|date:"H:i:s" }}</span>
                </div>
                <div>
                    <strong>Active Jobs:</strong>
                    <span class="badge bg-success float-end">{{ active_jobs }}</span>
                </div>
            </div>
        </div>

        <!-- Application Status -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Application Status</h5>
            </div>
            <div class="card-body">
                {% for status in application_status %}
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="small">{{ status.status|title }}</span>
                    <span class="badge bg-primary">{{ status.count }}</span>
                </div>
                {% empty %}
                <p class="text-muted text-center small">No application data</p>
                {% endfor %}
            </div>
        </div>

        <!-- Job Statistics -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Job Statistics</h5>
            </div>
            <div class="card-body">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="small">Active Jobs</span>
                    <span class="badge bg-success">{{ active_jobs }}</span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="small">Expired Jobs</span>
                    <span class="badge bg-danger">{{ expired_jobs }}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="small">Total Jobs</span>
                    <span class="badge bg-primary">{{ total_jobs }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Tools -->
<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0">System Tools</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 mb-3">
                <div class="card bg-light">
                    <div class="card-body text-center">
                        <i class="fas fa-database fa-2x text-primary mb-2"></i>
                        <h6>Database Backup</h6>
                        <button class="btn btn-sm btn-outline-primary mt-2" disabled>Backup Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-light">
                    <div class="card-body text-center">
                        <i class="fas fa-chart-bar fa-2x text-success mb-2"></i>
                        <h6>Reports</h6>
                        <button class="btn btn-sm btn-outline-success mt-2" disabled>Generate</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-light">
                    <div class="card-body text-center">
                        <i class="fas fa-envelope fa-2x text-info mb-2"></i>
                        <h6>Bulk Email</h6>
                        <button class="btn btn-sm btn-outline-info mt-2" disabled>Send</button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-light">
                    <div class="card-body text-center">
                        <i class="fas fa-cogs fa-2x text-warning mb-2"></i>
                        <h6>System Settings</h6>
                        <a href="/admin/" class="btn btn-sm btn-outline-warning mt-2">Configure</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    transition: transform 0.2s;
}
.card:hover {
    transform: translateY(-2px);
}
.badge {
    font-size: 0.7em;
}
.table th {
    border-top: none;
    font-weight: 600;
}
</style>
{% endblock %}